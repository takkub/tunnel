# ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CNAME ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö - ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** November 5, 2025  
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** CNAME records ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô `npm run cleanup`

## üîç ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö
1. ‚úÖ API ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥ - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏ö CNAME ‡∏ú‡πà‡∏≤‡∏ô API ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
2. ‚ùå Cleanup script ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤ condition ‡∏•‡∏ö CNAME
3. **Root Cause:** Script ‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ DNS routes ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏ï‡πà‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ DNS routes (‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß)

### ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤
```
1. ‡∏°‡∏µ tunnel + DNS route + CNAME
2. ‡∏•‡∏ö DNS route ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠ expire
3. ‡∏£‡∏±‡∏ô cleanup ‚Üí ‡∏´‡∏≤ DNS routes ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠
4. domainsToDelete = [] (‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)
5. ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤ condition ‡∏•‡∏ö CNAME
6. ‚ùå CNAME ‡∏¢‡∏±‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà
```

## ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç cleanup-tunnel.js

**‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏≤ domain ‡∏à‡∏≤‡∏Å config.yml:**
```javascript
// ‡∏´‡∏≤ domain ‡∏à‡∏≤‡∏Å config.yml ‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏ö CNAME ‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ DNS routes)
const configPath = path.join(projectRoot, 'tunnels', tunnelName, 'config.yml');
if (fs.existsSync(configPath)) {
  try {
    const configContent = fs.readFileSync(configPath, 'utf8');
    const hostnameMatch = configContent.match(/hostname:\s+([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/);
    if (hostnameMatch) {
      const domain = hostnameMatch[1];
      domainsToDelete.push(domain);
      console.log(`  ‚úì ‡∏û‡∏ö domain ‡∏à‡∏≤‡∏Å config: ${domain}`);
    }
  } catch (e) {
    // ‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ñ‡πâ‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
  }
}
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‚úÖ ‡∏´‡∏≤ domain ‡∏à‡∏≤‡∏Å config.yml ‡∏Å‡πà‡∏≠‡∏ô
- ‚úÖ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏ä‡πá‡∏Ñ DNS routes (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
- ‚úÖ ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô (check `!domainsToDelete.includes(domain)`)
- ‚úÖ ‡∏•‡∏ö CNAME ‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ DNS routes

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### Test 1: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö CNAME ‡∏ó‡∏µ‡πà‡∏°‡∏µ
```bash
npm run check-cnames

# Output:
# app.sabuytube.xyz
# game.sabuytube.xyz
# office.sabuytube.xyz  ‚Üê ‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà
```

### Test 2: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏ö CNAME ‡∏ú‡πà‡∏≤‡∏ô API
```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á test script
# ‚úÖ ‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - API ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
```

### Test 3: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç cleanup script
```bash
# ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏≤ domain ‡∏à‡∏≤‡∏Å config.yml
# ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏™‡∏£‡πá‡∏à
```

### Test 4: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
```bash
npm run check-cnames

# Output:
# app.sabuytube.xyz
# game.sabuytube.xyz
# ‚úÖ office ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!
```

## üìä ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
```
npm run cleanup office
‚Üí ‡πÑ‡∏°‡πà‡∏°‡∏µ DNS routes
‚Üí domainsToDelete = []
‚Üí ‚ùå ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤ condition ‡∏•‡∏ö CNAME
‚Üí ‚ùå CNAME ‡∏¢‡∏±‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà
```

### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
```
npm run cleanup office
‚Üí ‚úì ‡∏´‡∏≤ domain ‡∏à‡∏≤‡∏Å config.yml
‚Üí domainsToDelete = ['office.sabuytube.xyz']
‚Üí ‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤ condition ‡∏•‡∏ö CNAME
‚Üí ‚úÖ ‡∏•‡∏ö CNAME ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!
```

## üéØ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡πÄ‡∏ä‡πá‡∏Ñ CNAME ‡∏ó‡∏µ‡πà‡∏°‡∏µ
```bash
npm run check-cnames
```

### ‡∏•‡∏ö Tunnel (‡∏à‡∏∞‡∏•‡∏ö CNAME ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
```bash
npm run cleanup
# ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å tunnel ‚Üí ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚Üí ‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏° CNAME!
```

## üîß ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

1. ‚úÖ `scripts/cleanup-tunnel.js` - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏≤ domain ‡∏à‡∏≤‡∏Å config.yml
2. ‚úÖ `package.json` - ‡πÄ‡∏û‡∏¥‡πà‡∏° `check-cnames` script

## üìù Best Practices

### ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ
1. ‚úÖ ‡∏•‡∏ö‡∏ú‡πà‡∏≤‡∏ô `npm run cleanup` ‡πÄ‡∏™‡∏°‡∏≠ (‡∏•‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á)
2. ‚úÖ ‡πÑ‡∏°‡πà‡∏•‡∏ö DNS routes ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
3. ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ `npm run check-cnames` ‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö

### ‡∏ñ‡πâ‡∏≤ CNAME ‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà
```bash
# 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ CNAME ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á
npm run check-cnames

# 2. ‡∏£‡∏±‡∏ô cleanup ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
npm run cleanup

# 3. ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡∏ú‡πà‡∏≤‡∏ô Dashboard
https://dash.cloudflare.com/ ‚Üí DNS ‚Üí Records
```

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** Cleanup script ‡πÑ‡∏°‡πà‡∏•‡∏ö CNAME ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ DNS routes ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:** ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏≤ domain ‡∏à‡∏≤‡∏Å config.yml ‡∏Å‡πà‡∏≠‡∏ô

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** 
- ‚úÖ ‡∏•‡∏ö CNAME ‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ DNS routes
- ‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
- ‚úÖ CNAME office ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß

---

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!**

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:**
```bash
npm run cleanup      # ‡∏•‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏° CNAME
npm run check-cnames # ‡πÄ‡∏ä‡πá‡∏Ñ CNAME ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
```

