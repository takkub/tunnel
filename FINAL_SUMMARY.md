# тЬЕ р╕кр╕гр╕╕р╕Ы: Cleanup р╕Ьр╣Ир╕▓р╕Щ API (Interactive)

**р╕зр╕▒р╕Щр╕Чр╕╡р╣И:** November 5, 2025  
**р╕кр╕Цр╕▓р╕Щр╕░:** тЬЕ р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М

## ЁЯОп р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Чр╕│р╣Ар╕кр╕гр╣Зр╕И

### 1. тЬЕ р╕кр╕гр╣Йр╕▓р╕З Cloudflare API Module
**р╣Др╕Яр╕ер╣М:** `scripts/cloudflare-api.js`

**Functions:**
- `deleteDnsRecord(zoneId, recordId, apiToken)` - р╕ер╕Ъ DNS record
- `listDnsRecords(zoneId, apiToken)` - р╕Фр╕╢р╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г DNS records
- `findTunnelCnameRecords(zoneId, apiToken, tunnelId, domain)` - р╕лр╕▓ CNAME р╕Чр╕╡р╣Ир╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕З
- `deleteTunnelCnames(tunnelId, domain)` - р╕ер╕Ъ CNAME р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤

### 2. тЬЕ р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х Cleanup Script (Interactive)
**р╣Др╕Яр╕ер╣М:** `scripts/cleanup-tunnel.js`

**р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ:**
- тЬЕ **р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г tunnels р╕Чр╕╡р╣Ир╕бр╕╡**
- тЬЕ **р╕Цр╕▓р╕бр╕Кр╕╖р╣Ир╕н tunnel р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ъ**
- тЬЕ **р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╣Ир╕нр╕Щр╕ер╕Ъ**
- тЬЕ р╕ер╕Ъ CNAME р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Ьр╣Ир╕▓р╕Щ API (р╕Цр╣Йр╕▓р╕бр╕╡ .env)
- тЬЕ р╣Бр╕кр╕Фр╕Зр╕зр╕┤р╕Шр╕╡р╕ер╕Ър╕Фр╣Йр╕зр╕вр╕Хр╕Щр╣Ар╕нр╕Зр╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡ .env
- тЬЕ р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Чр╕╕р╕Бр╕Бр╕гр╕Ур╕╡ (graceful degradation)

### 3. тЬЕ р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Environment Variables
**р╣Др╕Яр╕ер╣М:** `.env.example`

**р╕Хр╣Йр╕нр╕Зр╕бр╕╡:**
```env
CLOUDFLARE_API_TOKEN=your-token
ZONE_ID=your-zone-id
```

### 5. тЬЕ р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Ар╕нр╕Бр╕кр╕▓р╕г
- `README.md` - р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ .env р╣Бр╕ер╕░ delete-cname
- `API_CLEANUP.md` - р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ API
- `package.json` - р╣Ар╕Юр╕┤р╣Ир╕б script р╣Бр╕ер╕░ dependency

## ЁЯЪА р╕зр╕┤р╕Шр╕╡р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ .env (р╕Др╕гр╕▒р╣Йр╕Зр╣Бр╕гр╕Б)

```bash
# 1. Copy example
copy .env.example .env

# 2. р╕лр╕▓ API Token
# https://dash.cloudflare.com/profile/api-tokens
# Create Token тЖТ Edit zone DNS тЖТ р╣Ар╕ер╕╖р╕нр╕Б domain тЖТ Copy token

# 3. р╕лр╕▓ Zone ID  
# https://dash.cloudflare.com/ тЖТ р╣Ар╕ер╕╖р╕нр╕Б domain тЖТ р╕Вр╕зр╕▓р╕бр╕╖р╕нр╕Ир╕░р╣Ар╕лр╣Зр╕Щ Zone ID

# 4. р╣Бр╕Бр╣Йр╣Др╕В .env
CLOUDFLARE_API_TOKEN=abc123...
ZONE_ID=xyz789...
```

### р╕ер╕Ъ Tunnel (Interactive)

```bash
npm run cleanup

# Step 1: р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г tunnels
# ЁЯУЛ Tunnels р╕Чр╕╡р╣Ир╕бр╕╡р╕нр╕вр╕╣р╣И:
#   1. app
#   2. office
# 
# р╕Кр╕╖р╣Ир╕н tunnel р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ъ: app

# Step 2: р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕ер╕Ъ
# тЪая╕П  р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ъ "app" р╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╕Ир╕гр╕┤р╕Зр╕лр╕гр╕╖р╕н? (yes/no): yes

# Step 3: р╕ер╕Ър╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
# [1/5] ЁЯЫС р╕лр╕вр╕╕р╕Ф Docker Container...
# [2/5] ЁЯФН р╕лр╕▓ Tunnel ID...
# [3/5] ЁЯМР р╕ер╕Ъ DNS Routes р╣Бр╕ер╕░ CNAME Records...
#   тЬУ р╕ер╕Ъ DNS routes: 1 р╕гр╕▓р╕вр╕Бр╕▓р╕г
#   ЁЯФД р╕Бр╕│р╕ер╕▒р╕Зр╕ер╕Ъ CNAME records р╕Ьр╣Ир╕▓р╕Щ Cloudflare API...
#   тЬЕ р╕ер╕Ъ CNAME records: 1 р╕гр╕▓р╕вр╕Бр╕▓р╕г
# [4/5] тШБя╕П р╕ер╕Ъ Tunnel р╕Ир╕▓р╕Б Cloudflare...
# [5/5] ЁЯУБ р╕ер╕Ър╣Др╕Яр╕ер╣М Local...
# 
# ЁЯОЙ р╕ер╕Ър╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М!
```

## ЁЯУК р╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф

| р╕Др╕│р╕кр╕▒р╣Ир╕З | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в |
|--------|----------|
| `npm run cleanup` | р╕ер╕Ъ tunnel (р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г тЖТ р╣Ар╕ер╕╖р╕нр╕Б тЖТ р╕вр╕╖р╕Щр╕вр╕▒р╕Щ тЖТ р╕ер╕Ър╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕З) |
| `npm run setup` | р╕кр╕гр╣Йр╕▓р╕З tunnel р╣Гр╕лр╕бр╣И (interactive) |
| `npm run status` | р╕Фр╕╣р╕кр╕Цр╕▓р╕Щр╕░ tunnels р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф |

## ЁЯФД Workflow

### р╕ер╕Ъ Tunnel
```bash
npm run cleanup
тЖТ р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г tunnels
тЖТ р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕н tunnel
тЖТ р╕вр╕╖р╕Щр╕вр╕▒р╕Щ
тЖТ р╕ер╕Ър╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕зр╕б CNAME р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
```

### р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡ .env
```bash
npm run cleanup
тЖТ р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г tunnels
тЖТ р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕н tunnel
тЖТ р╕вр╕╖р╕Щр╕вр╕▒р╕Щ
тЖТ р╕ер╕Ъ Docker, Routes, Tunnel, Files
тЖТ тЪая╕П р╣Бр╕кр╕Фр╕Зр╕зр╕┤р╕Шр╕╡р╕ер╕Ъ CNAME р╕Фр╣Йр╕зр╕вр╕Хр╕Щр╣Ар╕нр╕З
```

## ЁЯОУ р╕Вр╣Йр╕нр╕Фр╕╡

### тЬЕ Cleanup Script (Interactive)
- тЬЕ **р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Ир╕│р╕Кр╕╖р╣Ир╕н tunnel** - р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Гр╕лр╣Йр╣Ар╕ер╕╖р╕нр╕Б
- тЬЕ **р╕Цр╕▓р╕бр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╣Ир╕нр╕Щр╕ер╕Ъ** - р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕ер╕Ър╕Ьр╕┤р╕Ф
- тЬЕ р╕ер╕Ър╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╣Гр╕Щр╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Ар╕Фр╕╡р╕вр╕з
- тЬЕ р╕гр╕зр╕б CNAME р╕Цр╣Йр╕▓р╕бр╕╡ .env
- тЬЕ Fallback р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡ .env

### тЬЕ API Module
- Reusable functions
- Error handling р╕Фр╕╡
- р╣Гр╕Кр╣Й native HTTPS (р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З axios)

## ЁЯФР Security

- тЬЕ `.env` р╣Гр╕Щ `.gitignore`
- тЬЕ `.env.example` р╣Др╕бр╣Ир╕бр╕╡р╕Др╣Ир╕▓р╕Ир╕гр╕┤р╕З
- тЬЕ р╣Гр╕Кр╣Й API Token р╣Бр╕Чр╕Щ Global API Key
- тЬЕ Permission р╕Ир╕│р╕Бр╕▒р╕Фр╣Бр╕Др╣И Zone.DNS.Edit

## ЁЯУЭ Files Structure

```
tunnel/
тФЬтФАтФА .env.example          # р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓
тФЬтФАтФА .env                  # р╕Др╣Ир╕▓р╕Ир╕гр╕┤р╕З (р╣Др╕бр╣Ир╕Вр╕╢р╣Йр╕Щ git)
тФЬтФАтФА package.json          # р╣Ар╕Юр╕┤р╣Ир╕б dotenv р╣Бр╕ер╕░ scripts
тФЬтФАтФА scripts/
тФВ   тФЬтФАтФА cloudflare-api.js      # API module
тФВ   тФФтФАтФА cleanup-tunnel.js      # Cleanup script (Interactive + API)
тФФтФАтФА API_CLEANUP.md        # р╣Ар╕нр╕Бр╕кр╕▓р╕г
```

## тЬЕ Checklist

- [x] р╕кр╕гр╣Йр╕▓р╕З cloudflare-api.js
- [x] р╣Бр╕Бр╣Йр╣Др╕В cleanup-tunnel.js (async/await + API + Interactive)
- [x] р╕кр╕гр╣Йр╕▓р╕З .env.example
- [x] р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З dotenv
- [x] р╣Ар╕Юр╕┤р╣Ир╕б scripts р╣Гр╕Щ package.json
- [x] р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х README.md
- [x] р╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕нр╕Бр╕кр╕▓р╕г API_CLEANUP.md
- [x] р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ
- [x] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ .gitignore

## ЁЯОЙ р╕кр╕гр╕╕р╕Ы

**р╕Бр╣Ир╕нр╕Щ:**
```
npm run cleanup app
тЖТ р╕Хр╣Йр╕нр╕Зр╕Ир╕│р╕Кр╕╖р╣Ир╕н tunnel
тЖТ тЭМ р╕Хр╣Йр╕нр╕Зр╕ер╕Ъ CNAME р╣Ар╕нр╕З
```

**р╕Хр╕нр╕Щр╕Щр╕╡р╣Й:**
```
npm run cleanup
тЖТ тЬЕ р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г tunnels
тЖТ тЬЕ р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Ъ
тЖТ тЬЕ р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╣Ир╕нр╕Щр╕ер╕Ъ
тЖТ тЬЕ р╕ер╕Ър╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕зр╕б CNAME!
```

**Features:**
- тЬЕ **Interactive** - р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Гр╕лр╣Йр╣Ар╕ер╕╖р╕нр╕Б
- тЬЕ **р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╣Ир╕нр╕Щр╕ер╕Ъ** - р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕ер╕Ър╕Ьр╕┤р╕Ф
- тЬЕ р╕ер╕Ъ CNAME р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ (р╕Цр╣Йр╕▓р╕бр╕╡ .env)
- тЬЕ Graceful degradation (р╣Др╕бр╣Ир╕бр╕╡ .env р╕Бр╣Зр╣Гр╕Кр╣Йр╣Др╕Фр╣Й)
- тЬЕ Security (API Token р╣Др╕бр╣Ир╕Вр╕╢р╣Йр╕Щ git)

---

**р╕кр╕Цр╕▓р╕Щр╕░:** тЬЕ **р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ 100%!**

**Next Steps:**
1. Copy `.env.example` тЖТ `.env`
2. р╣Гр╕кр╣И API Token р╣Бр╕ер╕░ Zone ID
3. `npm run cleanup` - р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕г тЖТ р╣Ар╕ер╕╖р╕нр╕Б тЖТ р╕ер╕Ър╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕З!

